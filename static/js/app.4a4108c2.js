(function(e){function n(n){for(var r,a,c=n[0],u=n[1],d=n[2],l=0,v=[];l<c.length;l++)a=c[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&v.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);p&&p(n);while(v.length)v.shift()();return i.push.apply(i,d||[]),t()}function t(){for(var e,n=0;n<i.length;n++){for(var t=i[n],r=!0,c=1;c<t.length;c++){var u=t[c];0!==o[u]&&(r=!1)}r&&(i.splice(n--,1),e=a(a.s=t[0]))}return e}var r={},o={app:0},i=[];function a(n){if(r[n])return r[n].exports;var t=r[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=e,a.c=r,a.d=function(e,n,t){a.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,n){if(1&n&&(e=a(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)a.d(t,r,function(n){return e[n]}.bind(null,r));return t},a.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(n,"a",n),n},a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},a.p="/webgl_three_cesium/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=n,c=c.slice();for(var d=0;d<c.length;d++)n(c[d]);var p=u;i.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"56d7":function(e,n,t){"use strict";t.r(n);t("e260"),t("e6cf"),t("cca6"),t("a79d");var r=t("7a23");function o(e,n){var t=Object(r["u"])("router-view");return Object(r["o"])(),Object(r["c"])(t)}t("57ed");var i=t("6b0d"),a=t.n(i);const c={},u=a()(c,[["render",o]]);var d=u,p=t("6c02"),l={class:"home"};function v(e,n,t,o,i,a){return Object(r["o"])(),Object(r["d"])("div",l,[Object(r["e"])("div",{onClick:n[0]||(n[0]=function(){return o.water&&o.water.apply(o,arguments)})},"去水")])}var s={name:"Home",components:{},setup:function(){Object(p["c"])();var e=Object(p["d"])();function n(){e.push("/water")}return{water:n}}};const f=a()(s,[["render",v]]);var h=f,m=function(e){return Object(r["r"])("data-v-314a3f7d"),e=e(),Object(r["p"])(),e},w={class:"waterRoot"},b=Object(r["f"])("水 "),g=m((function(){return Object(r["e"])("div",{id:"threeContainer"},null,-1)})),x=[b,g];function j(e,n,t,o,i,a){return Object(r["o"])(),Object(r["d"])("div",w,x)}var y=t("5a89"),O=t("5c40"),D=t("4721"),P=t("34ad"),M=t("32d9"),T=t("360d"),N=t("93e9"),_=(t("31f6"),{name:"Water",setup:function(e,n){Object(O["w"])((function(){var e,n,t,r=document.getElementById("threeContainer"),o=new y["ab"](70,window.innerWidth/window.innerHeight,.01,1e3);o.position.z=10.2,o.position.y=.5;var i=new y["kb"],a=new y["kb"],c=new y["bb"](10,10,10,10),u=new y["Q"],d=new y["O"](c,u);d.rotation.x=-Math.PI/2,a.add(d);var p=new y["Db"]({antialias:!0});p.setSize(window.innerWidth,window.innerHeight),p.setAnimationLoop(b),t=new N["a"](i,o),e=new M["a"](p),e.addPass(t);var l=j({x:0,y:0,width:window.innerWidth,height:window.innerHeight},{near:0,far:1});n=new T["a"]({uniforms:{tDiffuse:{value:null},tDepth:{value:null},cameraNear:{value:o.near},cameraFar:{value:o.far},tNormal:{value:null},groundDepth:{value:null},viewPortMatrixInverse:{value:l},projectionMatrixInverse:{value:o.projectionMatrixInverse},cameraProjectionMatrix:{value:o.projectionMatrix}},vertexShader:"\n                varying vec2 vUv;\n                varying vec3 v_position;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n                }",fragmentShader:"\n                #include <packing>\n                varying vec2 vUv;\n                uniform float cameraNear;\n                uniform float cameraFar;\n                uniform sampler2D tDiffuse;\n                uniform sampler2D tDepth;\n                uniform sampler2D tNormal;\n                uniform sampler2D groundDepth;\n                uniform mat4 viewPortMatrixInverse;\n                uniform mat4 projectionMatrixInverse;\n                uniform mat4 cameraProjectionMatrix;\n                float readDepth( sampler2D depthSampler, vec2 coord ) {\n                    float fragCoordZ = texture2D( depthSampler, coord ).x;\n                    float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n                    return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n                }\n                vec3 getViewNormal( const in vec2 uv ) {\n                    return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );\n                }\n                float getViewZ( const in float depth ) {\n                    return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n                }\n                vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {\n                    vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc\n                    clipPosition *= clipW; //clip\n                    return ( projectionMatrixInverse * clipPosition ).xyz;//view\n                }\n                void main() {\n                    vec4 color = texture2D(tDiffuse,vUv);\n                    vec4 n = texture2D(tNormal,vUv);\n                    float depthMain = texture2D(tDepth,vUv).r;\n                    float depthGround = texture2D(groundDepth,vUv).r;\n                    if((n.r!=0. ||n.g!=0. ||n.b!=0.) && depthGround<depthMain){\n                        // color = n;//地面视图空间法线\n                        //先获取片元到视角向量(eyePos)\n                        float viewZ = getViewZ( depthGround );\n                        float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];\n\t\t\t            vec3 viewPosition=getViewPosition( vUv, depthGround, clipW ); //地面视图空间坐标获取到了\n                        color.xyz = viewPosition;\n                        //开始前进\n                    }\n                    gl_FragColor = color;\n\n                }"}),e.addPass(n);new D["a"](o,p.domElement);r.appendChild(p.domElement);var v="textures/",s=".png",f=[v+"px"+s,v+"nx"+s,v+"py"+s,v+"ny"+s,v+"pz"+s,v+"nz"+s],h=(new y["i"]).load(f);i.background=h;var m=g(),w=x();function b(t){e.renderer.setRenderTarget(m),e.renderer.render(i,o),n.uniforms.tDepth.value=m.depthTexture,e.renderer.setRenderTarget(w),e.renderer.render(a,o),n.uniforms.tNormal.value=w.texture,n.uniforms.groundDepth.value=w.depthTexture,e.renderer.setRenderTarget(null),e.render()}function g(){var e=new y["Cb"](window.innerWidth,window.innerHeight);return e.texture.minFilter=y["U"],e.texture.magFilter=y["U"],e.stencilBuffer=y["j"]===y["k"],e.depthTexture=new y["l"],e.depthTexture.format=y["j"],e.depthTexture.type=y["yb"],e}function x(){var e=new y["Cb"](window.innerWidth,window.innerHeight,{minFilter:y["U"],magFilter:y["U"],format:y["ib"],type:y["t"]});return e.stencilBuffer=y["j"]===y["k"],e.depthTexture=new y["l"],e.depthTexture.format=y["j"],e.depthTexture.type=y["yb"],e}function j(e,n){var t=new y["N"],r=new y["N"];return t.set(e.width/2,0,0,e.x+e.width/2,0,e.height/2,0,e.y+e.height/2,0,0,(n.far-n.near)/2,(n.far+n.near)/2,0,0,0,1),r.getInverse(t,!0),r}(new P["a"]).setPath("rose/").load("scene.gltf",(function(e){i.add(e.scene),e.scene.position.y=17,e.scene.position.z=-5}))}))}});t("9dc3");const U=a()(_,[["render",j],["__scopeId","data-v-314a3f7d"]]);var k=U,W=[{path:"/",name:"Home",component:h},{path:"/water",name:"Water",component:k}],Z=Object(p["a"])({history:Object(p["b"])(),routes:W}),F=Z;Object(r["b"])(d).use(F).mount("#app")},"57ed":function(e,n,t){"use strict";t("7de0")},"7de0":function(e,n,t){},"9dc3":function(e,n,t){"use strict";t("e2b4")},e2b4:function(e,n,t){}});
//# sourceMappingURL=app.4a4108c2.js.map